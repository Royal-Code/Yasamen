@using RoyalCode.Razor.Commons

<div class="z-offcanvas">
	<aside class="@Classes" @attributes="Attributes" @ref="asideRef" id="@dataRef" data-ref="@dataRef" @ontransitionEnded="TransitionEndHandler">
		<CascadingValue Value="handler">
			@if (UseBox)
			{
				<AsideBox Title="@Title" Size="@BoxSize" Closeable="@(Closeable ?? true)">
					@ChildContent
				</AsideBox>
			}
			else
			{
				@ChildContent
			}
		</CascadingValue>
	</aside>
</div>
<div class="@BackdropClasses" @onclick="BackdropClickHandler" @ref="backdropRef"></div>

@code {
	private string dataRef = Guid.NewGuid().ToString();
	private ElementReference? asideRef;
	private ElementReference? backdropRef;

	private string Classes => "ya-offcanvas"
		.AddClass(IsVisible, "ya-offcanvas-show")
		.AddClass(Position is Positions.Start, "ya-offcanvas-start", "ya-offcanvas-end")
		.AddClass(Fitting is Fitting.Overlaying, "ya-offcanvas-overlaying")
		.AddClass(Fitting is Fitting.Float, "ya-offcanvas-float")
		.AddClass(AdditionalClasses);

	private string BackdropClasses => "ya-offcanvas-backdrop"
		.AddClass(IsVisible && Modal, "ya-offcanvas-backdrop-show ya-modal-visible")
		.AddClass(Fitting is Fitting.Overlaying, "ya-offcanvas-backdrop-overlaying");

	private void TransitionEndHandler(TransitionEventEndArgs args)
	{
		Console.WriteLine($"Transition ended for OffCanvas ({asideRef?.Id}, {dataRef}): {args.ElapsedTime}, {args.PropertyName}, {args.DataRef}, {args.ElementId}");
	}
}